"use strict";async function log(e,t="[INFO]",o="white-text"){var a=$("#console"),n=$("<span>");n.attr("class",o),""!=t&&(t+=" "),n.html(t+e),a.append(n),a.append("<br>"),a.scrollTop(a[0].scrollHeight-a.height())}async function updateCommands(e=!0){$("#updateCommands").prop("disabled",!0),e&&log(l.updatingCommands,"[INFO]","yellow-text"),commands={};var t=$("#commands").val(),o=t.split(/;$/gm);for(var a in o){"\n"===o[a].charAt(0)&&(o[a]=o[a].substr(1));var n=o[a].splitTwo(" > "),s=0==n[1].indexOf("photo ");if(s){n[1]=n[1].splitTwo("photo ")[1];var r="";n[1].indexOf("\n")-1<n[1].length&&(r=n[1].splitTwo("\n")[1],n[1]=n[1].splitTwo(r)[0])}n[0]in commands?commands[n[0]].push(s?[n[1],"photo",r]:[n[1],"text"]):commands[n[0]]=s?[[n[1],"photo",r]]:[[n[1],"text"]]}localStorage.setItem("commands",$("#commands").val()),e&&log(l.updatedCommands,"[INFO]","green-text"),$("#updateCommands").prop("disabled",!1)}function htmlEncode(e){return $("<div>").text(e).html()}async function updateAnalyzer(){request("getUpdates",{offset:updateOffset},async function(e){var t={};if("stop"==started)return $("#startBot").prop("disabled",!1),log(l.botStopped,"[INFO]","blue-text"),started=0,!0;setTimeout(updateAnalyzer,$("#ufUpdAnalyzer").prop("checked")?0:500),e.result!==[]&&e.result&&e.result.length>0&&(debug&&(log("Received update "+htmlEncode(JSON.stringify(e)),"[DEBUG]"),startTime=(new Date).getTime(),log("Start Time: "+startTime,"[DEBUG]")),t=e.result[0],updateOffset=t.update_id,analyzeUpdate(t),updateOffset++),0==started&&(localStorage.setItem("botToken",$("#token").val()),log(l.botStarted,"[INFO]","blue-text"),log(l.helpCmd),$("#stopBot").prop("disabled",!1),request("getMe",{},async function(e){botInfo=e.result,botUsername=botInfo.username;var t=["{BOTNAME}","{TMEBOTUSERNAME}"],o=[htmlEncode(botInfo.first_name),'<a href="https://t.me/'+botUsername+'">@'+botUsername+"</a>"];log(l.botInfo.replaceArray(t,o))}),started=1)},async function(e){var t=e.responseText,o=JSON.parse(e.responseText),a="Errore sconosciuto";403==o.error_code||404==o.error_code?a=l.wrongToken:409==o.error_code&&(a=l.conflict),log(l.connectionError+t+"<br />"+a,l.logError,"red-text"),$("#stopBot").prop("disabled",!0),$("#startBot").prop("disabled",!1),started=0})}async function updateBotSettings(){if(""!=botToken&&botToken){if(debug){log("Updating bot settings...","[DEBUG]");var e=(new Date).getTime()}localStorage.setItem("botSettings",JSON.stringify({parseMode:$("#parseMode").val(),wpPreview:$("#wpPreview").val(),autoStart:$("#autoStart").prop("checked"),logAllMsg:$("#logAllMsg").prop("checked"),ufUpdAnalyzer:$("#ufUpdAnalyzer").prop("checked"),selectedChatId:selectedChatId,knownChatIDs:JSON.stringify(knownChatIDs)})),debug&&log("Updated bot settings<br />Response time: "+((new Date).getTime()-e)+"ms","[DEBUG]")}}async function analyzeUpdate(e){var t,o,a,n,s,r="",d=0,i="",c=!1,m=0;if(debug&&log("Analysing update: "+htmlEncode(JSON.stringify(e)),"[DEBUG]"),t="message"in e?e.message:{},!("chat"in t))return log(l.messageNotSupported,"[WARNING]","yellow-text"),!1;if(d=t.chat.id,"title"in t.chat&&(a=t.chat.title,c=!0),"from"in t&&("first_name"in t.from?(s=t.from.first_name,i=s):s="","last_name"in t.from?(n=t.from.last_name,i+=" "+n):n="",m="id"in t.from?t.from.id:0),o=void 0!==a?a:i,"text"in t)r="/"==t.text.charAt(0)?t.text.replace("@"+botUsername,""):t.text;else if("photo"in t){var p=t.photo[t.photo.length-1].file_id,g=t.caption;(selectedChatId==d||$("#logAllMsg").prop("checked"))&&request("getFile",{file_id:p},async function(e){var t="https://api.telegram.org/file/bot"+botToken+"/"+e.result.file_path;log('<span class="sentImg"><img src="'+t+'"><br>'+(g||"")+"</span>","["+(c?htmlEncode(a)+": ":"")+htmlEncode(i)+"]",selectedChatId==d?"yellow-text":"white-text")},async function(e){e.responseText&&log(e.responseText,l.logError,"red-text")}),r=""}else r=l.messageNotSupported;(selectedChatId==d||$("#logAllMsg").prop("checked"))&&r&&log(htmlEncode(r),"["+(c?htmlEncode(a)+": ":"")+htmlEncode(i)+"]",selectedChatId==d?"yellow-text":"white-text"),knownChatIDs[d]=o;var u=["{CHATID}","{USERID}","{CHATTITLE}","{NAME}","{FIRSTNAME}","{LASTNAME}","{MSGTEXT}","{HTMLESCAPEDMSGTEXT}"],h=[d,m,"HTML"==$("#parseMode").val()?htmlEncode(o):o,"HTML"==$("#parseMode").val()?htmlEncode(i):i,"HTML"==$("#parseMode").val()?htmlEncode(s):s,"HTML"==$("#parseMode").val()?htmlEncode(n):n,r,htmlEncode(r)];if("/fileid"==g&&sendMessage(d,"FileID: <code>"+p+"</code>",!1,"HTML"),r in commands&&""!=r)for(var b of commands[r])if("text"==b[1]){var f=b[0].replaceArray(u,h);debug&&log("Text to send: "+htmlEncode(f),"[DEBUG]"),sendMessage(d,f)}else if("photo"==b[1]){g="";2 in b&&(g=b[2].replaceArray(u,h),debug&&log("Caption to send: "+htmlEncode(g),"[DEBUG]")),sendPhoto(d,b[0],g)}if("any"in commands)for(var b in commands.any){f=commands.any[b].replaceArray(u,h);debug&&log("Text to send: "+htmlEncode(f),"[DEBUG]"),sendMessage(d,f)}debug&&log("Response Time: "+((new Date).getTime()-startTime)+"ms","[DEBUG]")}async function sendMessage(e,t,o=!1,a=!1,n=!1){if(a||(a=$("#parseMode").val()),n||(n=$("#wpPreview").val()),null!=e&&""!=e||e){var s={chat_id:e,text:t,parse_mode:a,disable_web_page_preview:n};return request("sendMessage",s,async function(t){o&&log(t.result.text,"["+l.messageSent+(e in knownChatIDs?knownChatIDs[e]:e)+"]","green-text")},async function(e){var t=e.responseText;log(l.sendMessageError+t,l.logError,"red-text")},!0),!0}return!1}async function sendPhoto(e,t,o="",a=!1,n=!1,s=!1){n||(n=$("#parseMode").val()),s||(s=$("#wpPreview").val());var r={chat_id:e,photo:t,caption:o,parse_mode:n=n,disable_web_page_preview:s};request("sendPhoto",r,async function(o){a&&request("getFile",{file_id:t},async function(t){var o="https://api.telegram.org/file/bot"+botToken+"/"+t.result.file_path;log('<span class="sentImg"><img src="'+o+'"></span>',"["+l.messageSent+": "+(e in knownChatIDs?knownChatIDs[e]:e)+"]","green-text")},async function(e){e.responseText&&log(e.responseText,l.logError,"red-text")})},async function(e){var t=e.responseText;log(l.sendMessageError+t,l.logError,"red-text")},!0)}async function request(e,t={},o=async function(){},a=async function(){},n=!0){$.ajax({url:"https://api.telegram.org/bot"+botToken+"/"+e,async:n,method:"POST",data:t,dataType:"json",success:o,error:a})}async function sendCommand(e){if(""!=botToken&&botToken&&1==started)switch(e.splitTwo(" ",1)[0]){case"/help":log(l.helpConsoleCommands,"");break;case"/select":var t=e.splitTwo(" ");if(1 in t&&t[1])selectedChatId=t[1],log(0==selectedChatId?l.removedChatIdSelection:l.selected+selectedChatId+"!","[INFO]","green-text"),updateBotSettings();else if($.isEmptyObject(knownChatIDs))log(l.noKnownChats,l.logError,"red-text");else{var o="";for(var a in knownChatIDs)o+='<option value="'+a+'"'+(a==selectedChatId?" selected":"")+">"+htmlEncode(knownChatIDs[a])+"</option>";$("#selectChatId").html(o).formSelect(),$("#selectChatIdModal").modal("open")}break;default:"/"==e.charAt(0)?log(l.unknownCommand,l.logError,"red-text"):0!=selectedChatId?(e=e.replace(/\\n/g,"\n"),e.replace(new RegExp(" ","g"),"").length>0?e.length<=4096?sendMessage(selectedChatId,e,!0):log(l.messageTooLong,l.logError,"red-text"):log(l.emptyMessage,l.logError,"red-text")):log(l.noChatSelected,l.logError,"red-text")}else log(l.consoleBotNotStarted,l.logError,"red-text")}var updateAnalyzer,botInfo,botToken="",updateOffset=-1,cookies=localStorage,commands={},started=0,selectedChatId=0,lastCommand="",botUsername="",knownChatIDs={},debug=!1,startTime=0,logTranslations={"it-IT":{startingBot:"Avviando il bot... Connessione in corso ai server telegram...",emptyToken:"Bot non avviato! Bot token vuoto!",stopSent:"Richiesta di arresto inviata!",autoStart:"Bot in avvio secondo le tue impostazioni...",userDidntStartBot:"L'utente selezionato precedentemente ha bloccato il bot o non lo ha mai avviato.",unknownError:"Errore sconosciuto: ",autoSelectCID1:"Selezionata chat ",autoSelectCID2:" come da sessione precedente.",updatingCommands:"Aggiornamento lista comandi in corso...",updatedCommands:"Aggiornamento lista comandi completato!",botStopped:"Bot arrestato!",botStarted:"Bot avviato! Attenzione: Se chiudi questa pagina, verrà anche arrestato il tuo bot!",helpCmd:"/help per i comandi della console.",botInfo:"Info Bot:<br>Nome: {BOTNAME}<br>Username: {TMEBOTUSERNAME}",wrongToken:"Token errato o non valido",conflict:"Conflitto, il bot ha il webhook già settato, oppure qualche altro programma è sul bot",connectionError:"Errore nella connessione: ",messageNotSupported:"Messaggio non supportato",sendMessageError:"Errore nell'invio del messaggio: ",helpConsoleCommands:"Menù comandi:<br />/help: visualizza questo menù di aiuto<br />/select: GUI per selezionare la chat in cui inviare i messaggi<br />&lt;messaggio&gt;: invia messaggio nella chat_id selezionata",removedChatIdSelection:"Rimossa selezione chat_id!",selected:"Selezionato ",noKnownChats:"Nessun chat_id conosciuto. Impossibile mostrare la GUI. Seleziona un chat_id manualmente con /select &lt;chat_id&gt;",unknownCommand:"Comando sconosciuto. /help per una lista completa di comandi.",messageTooLong:"Messaggio troppo lungo. Caratteri massimi consentiti: 4096 caratteri.",emptyMessage:"Messaggio nullo.",noChatSelected:"Per favore, prima di tentare di inviare un messaggio, usa /select",consoleBotNotStarted:'Prima di scrivere comandi, perfavore, metti il token del bot. Se lo hai già fatto, assicurati di aver avviato il bot cliccando il pulsante "Avvia"',messageSent:"Messaggio inviato: ",logError:"[ERRORE]"},en:{startingBot:"Starting the bot... Connecting to telegram servers...",emptyToken:"Bot not started! Bot token empty!",stopSent:"Stop request sent!",autoStart:"Starting the bot according to your settings...",userDidntStartBot:"The user previously selected has blocked the bot or he hasn't started it at all.",unknownError:"Unknown error: ",autoSelectCID1:"Selected chat ",autoSelectCID2:" as previous session.",updatingCommands:"Updating commands list...",updatedCommands:"Commands list updated!",botStopped:"Bot stopped!",botStarted:"Bot started! Warning: If you close this page, your bot will be stopped too!",helpCmd:"/help for the console commands.",botInfo:"Bot Info:<br>Name: {BOTNAME}<br>Username: {TMEBOTUSERNAME}",wrongToken:"Wrong token or token not valid",conflict:"Conflict, the bot has already setted webhook, or some other program is on the bot",connectionError:"Connection error: ",messageNotSupported:"Messsage not supported",sendMessageError:"Message sending error: ",helpConsoleCommands:"Commands menù:<br />/help: shows this help menu<br />/select: GUI to select chat to send messages in<br />&lt;messaggio&gt;: send message in selected chat",removedChatIdSelection:"Removed chat_id selection!",selected:"Selected ",noKnownChats:"No known chat_id. Unable to show the GUI. Select a chat_id manually with /select &lt;chat_id&gt;",unknownCommand:"Unknown command. /help for a commands list.",messageTooLong:"Message too long. Maximum allowed characters: 4096 characters.",emptyMessage:"Message empty.",noChatSelected:"Please, before trying to send a message, use /select",consoleBotNotStarted:'Before typing commands, enter the bot token. If you have already done it, make sure you\'ve clicked the "Start" button',messageSent:"Message sent",logError:"[ERROR]"}},translations={"it-IT":{commandsHelpTr:"/comando > Risposta<strong>;</strong><br>    Nella risposta, puoi usare <strong>photo</strong> seguito da un <strong>file_id/url</strong> (per mettere la descrizione alla foto, vai a capo) per inviare una foto, o un semplice testo per inviare una risposta testuale.<br>    Saranno aggiunti altri tipi di documenti/video presto.<br>    Per ricevere il file_id di una foto, manda una foto al tuo bot con descrizione /fileid    <br><br>    Nella risposta testuale puoi usare i seguenti codici:<br>    <code>{CHATID}</code>, <code>{USERID}</code>, <code>{CHATTITLE}</code>, <code>{NAME}</code>, <code>{FIRSTNAME}</code>, <code>{LASTNAME}</code>, <code>{MSGTEXT}</code>, <code>{HTMLESCAPEDMSGTEXT}</code>    <br>    <code>{CHATID}</code>: ID della chat<br>    <code>{USERID}</code>: ID utente<br>    <code>{CHATTITLE}</code>: Nel caso di un gruppo, il nome del gruppo, altrimenti il nome completo dell'utente<br>    <code>{NAME}</code>: Nome completo dell'utente<br>    <code>{FIRSTNAME}</code>: Nome dell'utente<br>    <code>{LASTNAME}</code>: Cognome dell'utente<br>    <code>{MSGTEXT}</code>: Testo messaggio inviato.<br>    <code>{HTMLESCAPEDMSGTEXT}</code>: Testo messaggio inviato escapato da HTML.    <br><br>    Mettendo <code>any</code> come comando, questo risponderà ad ogni comando.","tr-botToken":"Token del bot","tr-botcommands":"Comandi del bot",startBot:"Avvia!",stopBot:"Arresta","tr-autostart":"Avvia automaticamente il bot al caricamento della pagina","tr-logallmsg":"Logga i messaggi da qualsiasi chat","tr-createdby":"Creato da Pato05 <code>:)</code>","tr-cmdHelpTitle":"Help comandi",selectChId:"Seleziona la chat_id",removeChatId:"Rimuovi selezione"},en:{"tr-botToken":"Bot Token","tr-botcommands":"Bot commands",startBot:"Start!",stopBot:"Stop","tr-autostart":"Automatically start the bot at page load","tr-logallmsg":"Log messages from every chat","tr-createdby":"Created by Pato05 <code>:)</code>","tr-cmdHelpTitle":"Commands Help",selectChId:"Select the chat_id",removeChatId:"Remove selection",commandsHelpTr:"/command > Answer<strong>;</strong><br>    In the answer, you can use <strong>photo</strong> followed by <strong>file_id/url</strong> (to put the caption to a photo, start a new line) to send a photo, or a simple text to send a textual answer.<br>    Will be added new types of documents/videos soon<br>    To get a photo file_id, send a photo to your active bot with caption /fileid    <br><br>    In the textual answer or caption you can use these codes:<br>    <code>{CHATID}</code>, <code>{USERID}</code>, <code>{CHATTITLE}</code>, <code>{NAME}</code>, <code>{FIRSTNAME}</code>, <code>{LASTNAME}</code>, <code>{MSGTEXT}</code>, <code>{HTMLESCAPEDMSGTEXT}</code>    <br>    <code>{CHATID}</code>: Chat ID<br>    <code>{USERID}</code>: User ID<br>    <code>{CHATTITLE}</code>: In the case of a group, the group title, else the complete user's name<br>    <code>{NAME}</code>: Complete user's name<br>    <code>{FIRSTNAME}</code>: User's first name<br>    <code>{LASTNAME}</code>: User's last name<br>    <code>{MSGTEXT}</code>: Text of the message sent by the user<br>    <code>{HTMLESCAPEDMSGTEXT}</code>: Text of the message sent by the user HTML escaped.    <br><br>    Putting <code>any</code> as command, it will answer to each message."}},navLang=navigator.userLanguage||navigator.language,l=logTranslations[navLang]||logTranslations.en;String.prototype.splitTwo=function(e){var t=this.split(e),o=this.substr(t[0].length+e.length);return[t[0],o]},String.prototype.replaceArray=function(e,t){for(var o,a=this,n=0;n<e.length;n++)o=new RegExp(e[n],"g"),a=a.replace(o,t[n]);return a},$(document).ready(async function(){if(-1!=location.href.indexOf("#")){var e=location.href.substr(location.href.indexOf("#")+1);"debug=1"==e&&(debug=!0,setTimeout(function(){log("DEBUG mode enabled","[DEBUG]")},0))}if(navLang in translations)for(var[t,o]of Object.entries(translations[navLang]))$("#"+t).html(o);else for(var[t,o]of Object.entries(translations.en))$("#"+t).html(o);if($("#applyChatId").on("click",async function(){sendCommand("/select "+$("#selectChatId").val())}),$("#removeChatId").on("click",async function(){sendCommand("/select 0")}),$("#autoStart").on("change",updateBotSettings),$("#logAllMsg").on("change",updateBotSettings),$("#parseMode").on("change",updateBotSettings),$("#wpPreview").on("change",updateBotSettings),$("#ufUpdAnalyzer").on("change",updateBotSettings),$("#consoleCommandsGo").click(function(){var e=$("#consoleCommands");e.val().replace(/\\n/g,"\n");lastCommand=e.val(),sendCommand(e.val()),e.val("")}),$("#consoleCommands").focus(async function(){$("#consoleCommandsContainer").css("background","rgb(15, 15, 15)")}),$("#consoleCommands").blur(async function(){$("#consoleCommandsContainer").css("background","#000")}),$("#consoleCommands").keyup(async function(e){13==e.keyCode?$("#consoleCommandsGo").click():38==e.keyCode&&$(this).val(lastCommand)}),$("#startBot").click(function(){botToken=$("#token").val(),""!=botToken&&botToken?($("#startBot").prop("disabled",!0),log(l.startingBot,"[INFO]","blue-text"),updateAnalyzer()):log(l.emptyToken,l.logError,"red-text")}),$("#stopBot").click(async function(){started="stop",$("#stopBot").prop("disabled",!0),log(l.stopSent,"[INFO]","yellow-text")}),$("#commands").blur(async function(){updateCommands(!0)}),$("#updateCommands").click(updateCommands),"commands"in cookies?($("#commands").val(cookies.commands),-1!==cookies.commands.indexOf("///////////")&&($("#commands").val($("#commands").val().split("///////////").join("\n")),updateCommands())):$("#commands").val("/start > Messaggio di avvio!;\n/help > Menù di aiuto!;"),"botToken"in cookies&&($("#token").val(cookies.botToken),botToken=$("#token").val()),"botSettings"in cookies){var a=JSON.parse(cookies.botSettings);"parseMode"in a&&$("#parseMode").val(a.parseMode),"wpPreview"in a&&$("#wpPreview").val(a.wpPreview),"autoStart"in a&&($("#autoStart").prop("checked",a.autoStart),1==a.autoStart&&setTimeout(function(){log(l.autoStart,"[INFO]","yellow-text"),""!=botToken&&botToken?$("#startBot").click():(log(l.emptyToken,l.logError,"red-text"),$("#autoStart").prop("checked",!1),updateBotSettings())},0)),"logAllMsg"in a&&$("#logAllMsg").prop("checked",a.logAllMsg),"knownChatIDs"in a&&(knownChatIDs=JSON.parse(a.knownChatIDs)),"ufUpdAnalyzer"in a&&$("#ufUpdAnalyzer").prop("checked",a.ufUpdAnalyzer),"selectedChatId"in a&&0!=a.selectedChatId&&setTimeout(async function(){selectedChatId=a.selectedChatId,!selectedChatId in knownChatIDs?request("getChat",{chat_id:selectedChatId},function(e){},async function(e){var t=JSON.parse(e.responseText),o=t.error_code;t.description;log(403==o?l.userDidntStartBot:l.unknownError+JSON.stringify(t),l.logError,"red-text"),selectedChatId=""}):log(l.autoSelectCID1+knownChatIDs[selectedChatId]+l.autoSelectCID2,"[INFO]","yellow-text")},0)}setTimeout(function(){M.updateTextFields(),M.textareaAutoResize($("#commands")),$(".tooltipped").tooltip(),$("select").formSelect(),$(".modal").modal()},0),updateCommands(!1)});